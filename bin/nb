#!/bin/sh
# Personal notebook script
set -e

DDIR="$HOME/Dropbox/Apps/Plain.txt"

if [ ! -d "$DDIR" ]
then
	exit 1
fi

cd "$DDIR"

case $1 in
	recently) # least recently modified
		ls -t -1
		;;
	remind) # echo reminder if last journal is too long ago
		YEAR=$(date +%Y)
		FILE=$(ls -t -1 $YEAR* | head -1)
		MTIME=$(stat -c %Y $FILE)
		NOW=$(date +%s)
		DIFF=$(( ($NOW - $MTIME) / 60 ))
		# if more than 90 minutes then remind
		if [ $DIFF -gt 90 ]
		then
			echo "journal?"
		else
			exit 1
		fi
		;;
	skip-remind) # make reminder disappear for a little
		YEAR=$(date +%Y)
		FILE=$(ls -t -1 $YEAR* | head -1)
		touch $FILE
		;;
	journal) # edit journal entry for today
		FILE=$(date +%Y-%m-%d)
		PREV=$(date --date="yesterday" +%Y-%m-%d)
		if [ ! -f "$FILE" ]
		then
			echo >>$FILE "Wichtigste Aufgabe heute: "
			echo >>$FILE "Danke fÃ¼r: "
			echo >>$FILE "Gestern Zahnseide benutzt? "
			echo >>$FILE "Gestern Dual-N-Back? "
			if [ -f "$PREV" ]
			then
				JOB=$(cat "$PREV" | head -n 1 | cut -d ':' -f 2- | sed -e 's/^ *//' -e 's/ *$//')
				echo >>$FILE "Gestern \"$JOB\" erledigt? "
			fi
		fi
		echo >>$FILE
		echo $(date +%H:%M\ %:z) >>$FILE
		echo >>$FILE
		vim $FILE
		;;
	*) # start at main page
		vim main
		;;
esac
